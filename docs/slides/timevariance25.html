<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dave Clark">
<meta name="dcterms.date" content="2025-04-30">

<title>Time and Variance in the OLS model – 501 - Spring 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">501 - Spring 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus25.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../code.html"> 
<span class="menu-text">Code</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/clavedark/501sp2025">
            repo
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Time and Variance in the OLS model</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Dave Clark </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Binghamton University
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 30, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#time-and-variance" id="toc-time-and-variance" class="nav-link active" data-scroll-target="#time-and-variance">Time and Variance</a>
  <ul class="collapse">
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  </ul></li>
  <li><a href="#time" id="toc-time" class="nav-link" data-scroll-target="#time">Time</a>
  <ul class="collapse">
  <li><a href="#uncorrelated-disturbances" id="toc-uncorrelated-disturbances" class="nav-link" data-scroll-target="#uncorrelated-disturbances">Uncorrelated Disturbances</a></li>
  <li><a href="#temporal-correlation" id="toc-temporal-correlation" class="nav-link" data-scroll-target="#temporal-correlation">Temporal correlation</a></li>
  <li><a href="#autoregressive-processes" id="toc-autoregressive-processes" class="nav-link" data-scroll-target="#autoregressive-processes">Autoregressive Processes</a></li>
  <li><a href="#variance-covariance-matrix-of-widehatbeta" id="toc-variance-covariance-matrix-of-widehatbeta" class="nav-link" data-scroll-target="#variance-covariance-matrix-of-widehatbeta">Variance-Covariance matrix of <span class="math inline">\(\widehat{\beta}\)</span></a></li>
  <li><a href="#detecting-autocorrelation" id="toc-detecting-autocorrelation" class="nav-link" data-scroll-target="#detecting-autocorrelation">Detecting Autocorrelation</a></li>
  <li><a href="#graphical-methods---using-state-murder-rate-data-and-the-following-model" id="toc-graphical-methods---using-state-murder-rate-data-and-the-following-model" class="nav-link" data-scroll-target="#graphical-methods---using-state-murder-rate-data-and-the-following-model">Graphical Methods - using state murder rate data, and the following model:</a></li>
  <li><a href="#regression-based-detection" id="toc-regression-based-detection" class="nav-link" data-scroll-target="#regression-based-detection">Regression-based detection</a></li>
  <li><a href="#regression-based-methods" id="toc-regression-based-methods" class="nav-link" data-scroll-target="#regression-based-methods">Regression based methods</a>
  <ul class="collapse">
  <li><a href="#durbin-watson-d-statistic" id="toc-durbin-watson-d-statistic" class="nav-link" data-scroll-target="#durbin-watson-d-statistic">Durbin-Watson <em>d</em> Statistic</a></li>
  <li><a href="#breusch-godfrey-lm-test" id="toc-breusch-godfrey-lm-test" class="nav-link" data-scroll-target="#breusch-godfrey-lm-test">Breusch-Godfrey LM Test</a></li>
  <li><a href="#wooldridge-test-for-panel-data" id="toc-wooldridge-test-for-panel-data" class="nav-link" data-scroll-target="#wooldridge-test-for-panel-data">Wooldridge test for panel data</a></li>
  </ul></li>
  <li><a href="#correcting-ar1-processes" id="toc-correcting-ar1-processes" class="nav-link" data-scroll-target="#correcting-ar1-processes">Correcting AR(1) processes</a></li>
  <li><a href="#rho-transformations" id="toc-rho-transformations" class="nav-link" data-scroll-target="#rho-transformations"><span class="math inline">\(\rho\)</span>-transformations</a></li>
  <li><a href="#dynamic-models" id="toc-dynamic-models" class="nav-link" data-scroll-target="#dynamic-models">Dynamic Models</a></li>
  </ul></li>
  <li><a href="#variance" id="toc-variance" class="nav-link" data-scroll-target="#variance">Variance</a>
  <ul class="collapse">
  <li><a href="#what-is-non-constant-variance" id="toc-what-is-non-constant-variance" class="nav-link" data-scroll-target="#what-is-non-constant-variance">What is non constant variance</a></li>
  <li><a href="#why-does-it-happen" id="toc-why-does-it-happen" class="nav-link" data-scroll-target="#why-does-it-happen">Why does it happen?</a></li>
  <li><a href="#what-to-do" id="toc-what-to-do" class="nav-link" data-scroll-target="#what-to-do">What to do?</a></li>
  <li><a href="#visualizing-variance" id="toc-visualizing-variance" class="nav-link" data-scroll-target="#visualizing-variance">Visualizing variance</a></li>
  <li><a href="#variance-of-epsilon" id="toc-variance-of-epsilon" class="nav-link" data-scroll-target="#variance-of-epsilon">Variance of <span class="math inline">\(\epsilon\)</span></a></li>
  <li><a href="#ols-variance-covariance-matrix" id="toc-ols-variance-covariance-matrix" class="nav-link" data-scroll-target="#ols-variance-covariance-matrix">OLS variance-covariance matrix</a></li>
  <li><a href="#detection" id="toc-detection" class="nav-link" data-scroll-target="#detection">Detection</a></li>
  <li><a href="#graphical-methods" id="toc-graphical-methods" class="nav-link" data-scroll-target="#graphical-methods">Graphical methods</a></li>
  <li><a href="#breusch-pagan-test" id="toc-breusch-pagan-test" class="nav-link" data-scroll-target="#breusch-pagan-test">Breusch-Pagan test</a></li>
  </ul></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a>
  <ul class="collapse">
  <li><a href="#robust-standard-errors" id="toc-robust-standard-errors" class="nav-link" data-scroll-target="#robust-standard-errors">Robust Standard Errors</a>
  <ul class="collapse">
  <li><a href="#panel-data" id="toc-panel-data" class="nav-link" data-scroll-target="#panel-data">Panel data</a></li>
  </ul></li>
  <li><a href="#weighting-wls" id="toc-weighting-wls" class="nav-link" data-scroll-target="#weighting-wls">Weighting (WLS)</a></li>
  <li><a href="#modeling-variance" id="toc-modeling-variance" class="nav-link" data-scroll-target="#modeling-variance">Modeling Variance</a></li>
  <li><a href="#variance-model-example" id="toc-variance-model-example" class="nav-link" data-scroll-target="#variance-model-example">Variance model example</a></li>
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">The model</a></li>
  <li><a href="#aside-on-measurement" id="toc-aside-on-measurement" class="nav-link" data-scroll-target="#aside-on-measurement">Aside on Measurement</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<!-- render 2 types at same time; terminal "quarto render file.qmd" -->
<!-- https://quarto.org/docs/output-formats/html-multi-format.html -->
<!-- tables, smaller font and striping -->
<style>
table, th, td {
    font-size: 18px;
}
tr:nth-child(odd) {
  background-color: # f2f2f2;
}
</style>
<!-- <script src="https://cdn.jsdelivr.net/gh/ncase/nutshell/nutshell.js"></script> -->
<section id="time-and-variance" class="level1">
<h1>Time and Variance</h1>
<p>Our discussion of panel data emphasized the space and time dimensions and what the consequences of heterogeneity might be. Those dimensions may also have characteristics that violate the OLS assumptions so we can no longer rely on the BLUE properties of the estimator.</p>
<p>This is a very brief overview of time and variance issues in the OLS model.</p>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions</h2>
<p>Recall these assumptions:</p>
<p>This one holds that cross sections will have <em>identically</em> distributed disturbances.</p>
<p><strong>Homoskedastic disturbances:</strong> <span class="math inline">\(Var(u|x_1,x_2,\ldots,x_k)=\sigma^2\)</span></p>
<p>And this one holds that the disturbances will be <em>independent</em>.</p>
<p><strong>Uncorrelated disturbances:</strong> <span class="math inline">\(cov(u_i,u_j|x_1,x_2,\ldots,x_k)=0\)</span></p>
<p>Let’s call these collectively the i.i.d. assumption.</p>
</section>
</section>
<section id="time" class="level1">
<h1>Time</h1>
<section id="uncorrelated-disturbances" class="level2">
<h2 class="anchored" data-anchor-id="uncorrelated-disturbances">Uncorrelated Disturbances</h2>
<p>The model assumes the errors are not correlated with each other such that:</p>
<p><span class="math display">\[cov(u_t, u_{t-k} = 0)\]</span></p>
<p>the errors are not correlated across time;</p>
<p>and</p>
<p><span class="math display">\[cov(u_i, u_j = 0)\]</span> the errors are not correlated across units or cross-sections (so across space).</p>
<p>You should be able to see why the first can be an issue in time series data, the second in cross-sectional data, and both in panel data.</p>
</section>
<section id="temporal-correlation" class="level2">
<h2 class="anchored" data-anchor-id="temporal-correlation">Temporal correlation</h2>
<p>The nature of temporal correlations varies hugely. The focus of most basic time series analysis is autocorrelation - the error is correlated with itself at some point in the past so that,</p>
<p><span class="math display">\[
cov[u_t,u_{t-k}] \neq 0,  \nonumber
\]</span></p>
<p>Because the errors are not independent, and because we know the rough source of their dependency, we could conceive of <span class="math inline">\(u_t\)</span> as</p>
<p><span class="math display">\[
u_t= \rho u_{t-1} + \varepsilon_t  ~~~\forall t, ~~~-1 &lt; \rho &lt; 1
\]</span></p>
<p>where the error at <span class="math inline">\(t\)</span> is a function of the error at <span class="math inline">\(t-1\)</span> and <span class="math inline">\(\rho\)</span> is the coefficient indicating the effect of <span class="math inline">\(u_{t-1}\)</span> on <span class="math inline">\(u_t\)</span>.</p>
<p>This conceptualization of <span class="math inline">\(u_t\)</span> is known as a <strong>first order autoregressive process</strong> or AR(1) because we’ve assumed <span class="math inline">\(u_t\)</span> is a function of <span class="math inline">\(u_{t-1}\)</span> rather than some other order or lag of <span class="math inline">\(u\)</span>; note we could just as easily model higher order lags as AR(t) functions.</p>
<p>Also note the inclusion of an error term, <span class="math inline">\(\varepsilon_t\)</span> satisfying the GM assumptions, so:</p>
<p><span class="math display">\[E[\varepsilon_t] =0\]</span> <span class="math display">\[Var(\varepsilon_t)= \sigma^2\]</span> <span class="math display">\[Cov(\varepsilon_t, \varepsilon_{t-k})=0 \]</span></p>
</section>
<section id="autoregressive-processes" class="level2">
<h2 class="anchored" data-anchor-id="autoregressive-processes">Autoregressive Processes</h2>
<p>Let’s think about the errors <span class="math inline">\(u_t\)</span> for all <span class="math inline">\(t\)</span> in the AR scheme:</p>
<p><span class="math display">\[\begin{align*}
u_t= \rho u_{t-1} + \varepsilon_t
= \rho(\rho u_{t-2} +\varepsilon_{t-1}) + \varepsilon_t  \nonumber \\
= \rho^2 u_{t-2} + \rho \varepsilon_{t-1} + \varepsilon_t  \nonumber \\
= \rho^2(\rho u_{t-3} + \varepsilon_{t-2}) + \rho \varepsilon_{t-1}+ \varepsilon_t  \nonumber \\
= \rho^3 u_{t-3} + \rho^2 \varepsilon_{t-2} + \rho \varepsilon_{t-1}+ \varepsilon_t  \nonumber \\
\vdots \nonumber \\
= \rho^s u_{t-s} + \rho^{s-1} \varepsilon_{t-s+1} + \rho^{s-2} \varepsilon_{t-s+2}+ \ldots + \rho \varepsilon_{t-1} + \varepsilon_t  \nonumber \\ \nonumber \\
u_t= \sum \limits_{s=0}^{\infty} \rho^s u_{t-s}
\end{align*}\]</span></p>
<p>You can see the effect of the lagged residuals up to <span class="math inline">\(s\)</span> on <span class="math inline">\(u_t\)</span>; since <span class="math inline">\(|\rho| &lt; 1\)</span>, then <span class="math inline">\(|\rho^2| &lt; |\rho|\)</span>, and so forth, so the effect of each successive lag (<span class="math inline">\(t-2, t-3, \ldots, t-s\)</span>) is smaller than the previous lag, eventually decaying to zero.</p>
</section>
<section id="variance-covariance-matrix-of-widehatbeta" class="level2">
<h2 class="anchored" data-anchor-id="variance-covariance-matrix-of-widehatbeta">Variance-Covariance matrix of <span class="math inline">\(\widehat{\beta}\)</span></h2>
<p>If the errors are correlated, then the variance-covariance matrix is certain to be troubled by that correlation if it is not corrected. In fact,</p>
<p><span class="math display">\[\begin{align*}
Var(u_t)= \frac{\sigma^2}{1-\rho^2} \\
Cov(u_t, u_{t-1})= \rho \sigma^2 \\
Cov(u_t, u_{t-2})= \rho^2 \sigma^2 \\
Cov(u_t, u_{t-3})= \rho^3 \sigma^2 \\
\vdots \\
Cov(u_t, u_{t-s})= \rho^s \sigma^2 \\
\end{align*}\]</span></p>
<p>so it’s easy to see that if <span class="math inline">\(\rho=0\)</span>, then:</p>
<p><span class="math display">\[
u_t= \varepsilon_t \nonumber \\
Var(u_t)= \sigma_\varepsilon^2 \nonumber \\
cov(u_{t}, u_{t-k})=0 \nonumber
\]</span></p>
<p>If <span class="math inline">\(\rho \neq 0\)</span> the OLS estimator is not BLUE; even though the estimates are unbiased, they are inefficient, so the standard errors are not based on minimum variance in the class of estimators.</p>
</section>
<section id="detecting-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="detecting-autocorrelation">Detecting Autocorrelation</h2>
<p>We’ll focus on two approaches:</p>
<ul>
<li><p>graphical methods.</p></li>
<li><p>regression-based methods.</p></li>
</ul>
</section>
<section id="graphical-methods---using-state-murder-rate-data-and-the-following-model" class="level2">
<h2 class="anchored" data-anchor-id="graphical-methods---using-state-murder-rate-data-and-the-following-model">Graphical Methods - using state murder rate data, and the following model:</h2>
<p>ms &lt;- lm(murder ~ south + unemp + hsdip + citid + prcapinc, data=states)</p>
<p>Let’s plot the <span class="math inline">\(y\)</span> variable against the residuals and look for any patterns:</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"/Users/dave/Documents/teaching/501/2023/slides/L8_panel/code/USstatedata.dta"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ms <span class="ot">&lt;-</span> <span class="fu">lm</span>(murder <span class="sc">~</span> south <span class="sc">+</span> unemp <span class="sc">+</span> hsdip <span class="sc">+</span> citid <span class="sc">+</span> prcapinc, <span class="at">data=</span>states)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ms)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> states <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">res=</span><span class="fu">residuals</span>(ms))  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> states <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res1=</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(res,<span class="dv">1</span>), <span class="at">res2=</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(res,<span class="at">n=</span><span class="dv">2</span>), <span class="at">res3=</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(res,<span class="at">n=</span><span class="dv">3</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>statesxs <span class="ot">&lt;-</span> states <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(statename) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(murder,res, res1, res2, res3), mean, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(statesxs, aes(x=res_mean, y=murder_mean))+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point()</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(states, <span class="fu">aes</span>(<span class="at">x=</span>res, <span class="at">y=</span>murder))<span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="timevariance25_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
<p>And plot the residuals against lags of the residuals (at <span class="math inline">\(t-1\)</span>, <span class="math inline">\(t-2\)</span>, and <span class="math inline">\(t-3\)</span>):</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>statesxs, <span class="fu">aes</span>(<span class="at">x=</span>res, <span class="at">y=</span>res1),<span class="at">color=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>statesxs, <span class="fu">aes</span>(<span class="at">x=</span>res, <span class="at">y=</span>res2), <span class="at">color=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data=</span>statesxs, <span class="fu">aes</span>(<span class="at">x=</span>res, <span class="at">y=</span>res3), <span class="at">color=</span><span class="st">"yellow"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="timevariance25_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
<p>Both plots indicate the residuals are not random. The second plot indicates that the residuals are correlated over time since the units are the residuals measured at different lags.</p>
</section>
<section id="regression-based-detection" class="level2">
<h2 class="anchored" data-anchor-id="regression-based-detection">Regression-based detection</h2>
<p>Most regression based detection methods are rooted in regressing the residuals on lags of the residuals - call this an “autocorrelation functions.” Write the autocorrelation function:</p>
<p><span class="math display">\[\begin{eqnarray}
u_t= \rho u_{t-1} + \varepsilon_t  ~~~\forall t, ~~~-1 &lt; \rho &lt; 1
\nonumber
\end{eqnarray}\]</span></p>
<p>We can estimate this <em>auxiliary regression</em> using the residuals and their lagged values. The coefficient on <span class="math inline">\(u_{t-1}\)</span> is our estimate <span class="math inline">\(\hat{\rho}\)</span>. To meet the OLS assumption, <span class="math inline">\(\hat{\rho}\)</span> should be zero.</p>
</section>
<section id="regression-based-methods" class="level2">
<h2 class="anchored" data-anchor-id="regression-based-methods">Regression based methods</h2>
<p>We’ll look at three regression based methods:</p>
<ul>
<li>Durbin-Watson</li>
<li>Breusch-Godfrey</li>
<li>Wooldridge</li>
</ul>
<p>All three rely on estimating the OLS model, generating the residuals, and examining the relationships among different lags of the residuals for evidence of correlation.</p>
<p>The DW <em>d</em> is specifically designed for time-series data with exclusively exogenous variables in the model. In other words, models with lagged endogenous variables cannot be appropriately diagnosed using DW’s <em>d</em>. Instead, you should use Durbin and Watson’s <em>h</em> statistic or the BG Lagrange Multiplier test.</p>
<p>This is maybe the simplest regression-based way to detect autocorrelation:</p>
<ul>
<li>estimate the regression of interest</li>
<li>generate the residuals</li>
<li>regress the residuals on its lag (or lags)</li>
<li>if the coefficient on the lagged residuals is different from zero, some sort of AR process exists.</li>
</ul>
<section id="durbin-watson-d-statistic" class="level3">
<h3 class="anchored" data-anchor-id="durbin-watson-d-statistic">Durbin-Watson <em>d</em> Statistic</h3>
<p>The <em>d</em> statistic tests a variety of null hypotheses, all supposing no AR(1) process exists. It has limited application because of the assumptions on which it’s based:</p>
<ul>
<li>the regression includes an intercept.</li>
<li>the <span class="math inline">\(x\)</span> variables are fixed.</li>
<li>the errors are AR(1)</li>
<li>the model has no lagged endogenous variables.</li>
<li>there are no missing observations in the time series.</li>
</ul>
<p>Beyond these limitations, the statistic has a bizarre distribution for which DW computed upper and lower bounds (outside of which we reject the null of no autocorrelation), but in the middle of which there is a region known as the “indeterminate” zone or “zone of indecision.”</p>
<p>Here’s how the statistic is computed:</p>
<p><span class="math display">\[
d= \frac{\sum \hat{u}_{t}^{2} + \sum \hat{u}_{t-1}^{2} -2 \sum
\hat{u}_{t}\hat{u}_{t-1}}{\sum \hat{u}_{t}^{2}} \nonumber
\]</span></p>
<p>Because the residuals and lagged residuals differ by one observation, they are not equal, but are approximately equal, so we can set them equal and write:</p>
<p><span class="math display">\[
d= 2  \left( 1- \frac{\sum \hat{u}_{t}\hat{u}_{t-1}}{\sum
\hat{u}_{t}^{2}} \right) \nonumber
\]</span></p>
<p>The last term of this equation is <span class="math inline">\(\rho\)</span> - you can see the numerator is the covariation of the residuals and their lag, and the denominator is the sum squared residuals; this is a correlation coefficient indicating the correlation between <span class="math inline">\(u_t, u_{t-1}\)</span>.</p>
<p><span class="math display">\[
\rho =  \frac{\sum \hat{u}_{t}\hat{u}_{t-1}}{\sum \hat{u}_{t}^{2}}
\]</span></p>
<p>Consistent with the restrictions/assumptions underlying this statistic, note that we’ve estimated <span class="math inline">\(\rho_{1}\)</span> and so only can test for an AR(1) process. Given our estimate of <span class="math inline">\(\rho\)</span>, we can compute <em>d</em> as</p>
<p><span class="math display">\[
d= 2(1-\hat{\rho})  \nonumber
\]</span></p>
<p>And since <span class="math inline">\(\rho\)</span> is bounded by -1 and +1, <em>d</em> must be bounded by 0 and 4.</p>
<p>Here are the criteria for evaluating Durbin-Watson statistics:</p>
</section>
<section id="breusch-godfrey-lm-test" class="level3">
<h3 class="anchored" data-anchor-id="breusch-godfrey-lm-test">Breusch-Godfrey LM Test</h3>
<p>The BG test is a more general test because it can account for higher order AR processes (while DW is limited to AR(1)). Moreover, the BG test is simple to compute by hand and has few of the limitations listed above for DW. \alert{Note, this is not appropriate for panel data.</p>
<p>Here’s how it works:</p>
<ul>
<li>Estimate the OLS regression model.</li>
<li>Generate the residuals.</li>
<li>Regress the residuals, <span class="math inline">\(\hat{u}_t\)</span>, on all the <span class="math inline">\(x\)</span> variables in the model plus as many lagged values of <span class="math inline">\(\hat{u}_t\)</span> as you want to test, so; <span class="math inline">\(\hat{u}_{t-1}\)</span>, <span class="math inline">\(\hat{u}_{t-2}\)</span>, <span class="math inline">\(\hat{u}_{t-3}\)</span>, <span class="math inline">\(\hat{u}_{t-p}\)</span> etc.</li>
</ul>
<p>In this example, we’re testing 3 lags, so <span class="math inline">\(p=3\)</span>. The regression would be:</p>
<p><span class="math display">\[
\hat{u}_t= X\beta+\rho_1 \hat{u}_{t-1} +\rho_2 \hat{u}_{t-2}+\rho_3
\hat{u}_{t-3} \nonumber
\]</span></p>
<p>Using the <span class="math inline">\(R^2\)</span> from this auxiliary regression, generate the BG LM statistic as:</p>
<p><span class="math display">\[
(n-p) R^2 ~~ \sim \chi_p^2
\]</span></p>
<p>The BG is a <span class="math inline">\(\chi_p^2\)</span> statistic with <span class="math inline">\(p\)</span> degrees of freedom. The null hypothesis is that <span class="math inline">\(\rho_1=\rho_2=\rho_3=0\)</span>. The BG test not only allows testing for higher order AR processes, but can be used in models with lagged endogenous variables as well.</p>
</section>
<section id="wooldridge-test-for-panel-data" class="level3">
<h3 class="anchored" data-anchor-id="wooldridge-test-for-panel-data">Wooldridge test for panel data</h3>
<p>Wooldridge’s test is simple; note that it’s appropriate for panel data as well.</p>
<ul>
<li>difference all variables; estimate the differenced regression, clustered by panel, excluding a constant.</li>
<li>generate the residuals from this regression.</li>
<li>regress the residuals on their lag, no constant, clustered by panel.</li>
<li>test the null hypothesis that <span class="math inline">\(\beta\)</span> on the lag of the residual is equal to -.5.</li>
</ul>
</section>
</section>
<section id="correcting-ar1-processes" class="level2">
<h2 class="anchored" data-anchor-id="correcting-ar1-processes">Correcting AR(1) processes</h2>
<p>Most methods for dealing with autocorrelation seek to purge the temporal dependence from the data by transforming the data.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Generalized Least Squares">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Generalized Least Squares
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generalized Least Squares: OLS on data transformed such that the data satisfy the assumptions of the OLS model.</p>
</div>
</div>
<p>One common GLS method for dealing with correlated errors is to estimate <span class="math inline">\(\rho\)</span>-transformed models - two common variants are the Prais-Winsten and Cochrane-Orcutt regressions.</p>
</section>
<section id="rho-transformations" class="level2">
<h2 class="anchored" data-anchor-id="rho-transformations"><span class="math inline">\(\rho\)</span>-transformations</h2>
<p>The intuition of <span class="math inline">\(\rho\)</span>-transformed models is simple:</p>
<ul>
<li>estimate the regression of interest.</li>
<li>generate the residuals.</li>
<li>estimate <span class="math inline">\(\hat{\rho}\)</span> as above.</li>
<li>transform the variables by <span class="math inline">\(\rho\)</span> such that: <span class="math display">\[y_t - \rho y_{t-1} = \beta_0(1-\rho)+ \beta_1(x_{1,t} - \rho x_{1,t-1}) \ldots\]</span></li>
<li>call the new transformed variables <span class="math inline">\(y^*, x^*\)</span></li>
<li>estimate the regression <span class="math inline">\(y^*=\beta^*_0+\beta^*_1(x^*)\)</span></li>
</ul>
<p>This particular process is the Cochrane-Orcutt 2-step method. Others are similar (mainly the Prais-Winsten). The estimates are now corrected by the estimated value of <span class="math inline">\(\rho\)</span>. These are also appropriate for panel data where the <span class="math inline">\(rho\)</span>-transformation is applied to the data for each panel separately.</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"/Users/dave/Documents/teaching/501/2023/slides/L8_panel/code/USstatedata.dta"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set state and year as panel identifiers</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>states_panel <span class="ot">&lt;-</span> <span class="fu">pdata.frame</span>(states, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Original OLS model for comparison</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>ms_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(murder <span class="sc">~</span> south <span class="sc">+</span> unemp <span class="sc">+</span> hsdip <span class="sc">+</span> citid <span class="sc">+</span> prcapinc, <span class="at">data =</span> states)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Prais-Winsten correction for panel data with panel-specific AR(1) parameters</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>ms_pw <span class="ot">&lt;-</span> <span class="fu">prais_winsten</span>(murder <span class="sc">~</span> south <span class="sc">+</span> unemp <span class="sc">+</span> hsdip <span class="sc">+</span> citid <span class="sc">+</span> prcapinc, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> states,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">panelwise =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rhoweight =</span> <span class="st">"T"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create tidy dataframe for Prais-Winsten</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>ti <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"south"</span>, <span class="st">"unemp"</span>, <span class="st">"hsdip"</span>, <span class="st">"citid"</span>, <span class="st">"prcapinc"</span>),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="fu">coef</span>(ms_pw), </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">std.error =</span> <span class="fu">coef</span>(<span class="fu">summary</span>(ms_pw))[, <span class="st">"Std. Error"</span>],</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">coef</span>(ms_pw) <span class="sc">/</span> <span class="fu">coef</span>(<span class="fu">summary</span>(ms_pw))[, <span class="st">"Std. Error"</span>],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(<span class="fu">coef</span>(ms_pw) <span class="sc">/</span> <span class="fu">coef</span>(<span class="fu">summary</span>(ms_pw))[, <span class="st">"Std. Error"</span>]), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create glance dataframe for Prais-Winsten</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">r.squared =</span> <span class="fu">summary</span>(ms_pw)<span class="sc">$</span>r.squared,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">adj.r.squared =</span> <span class="fu">summary</span>(ms_pw)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">nobs =</span> <span class="fu">length</span>(<span class="fu">residuals</span>(ms_pw)),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> ms_pw<span class="sc">$</span>rho[<span class="dv">7</span>]</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom model object</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>mod_pw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidy =</span> ti,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">glance =</span> gl)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mod_pw) <span class="ot">&lt;-</span> <span class="st">"modelsummary_list"</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the GOF map</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>gof_map <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>raw,              <span class="sc">~</span>clean,              <span class="sc">~</span>fmt,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nobs"</span>,            <span class="st">"N"</span>,                 <span class="dv">0</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r.squared"</span>,       <span class="st">"R²"</span>,                <span class="dv">3</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"adj.r.squared"</span>,   <span class="st">"Adjusted R²"</span>,       <span class="dv">3</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rho"</span>,             <span class="st">"AR(1) coefficient"</span>, <span class="dv">3</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model summary with explicit column names</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"OLS"</span> <span class="ot">=</span> ms_ols, <span class="st">"Prais-Winsten"</span> <span class="ot">=</span> mod_pw),</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Comparison of Panel Data Models for Murder Rate"</span>,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> <span class="fu">c</span>(</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="st">"Intercept"</span>,</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"south"</span> <span class="ot">=</span> <span class="st">"South"</span>,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"unemp"</span> <span class="ot">=</span> <span class="st">"Unemployment"</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hsdip"</span> <span class="ot">=</span> <span class="st">"High School Diploma"</span>, </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"citid"</span> <span class="ot">=</span> <span class="st">"Citizen Ideology"</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prcapinc"</span> <span class="ot">=</span> <span class="st">"Per Capita Income"</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gof_map,</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="st">"%.4f"</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<!-- preamble start -->

    <script>
      function styleCell_828rqa6l5dyf1ea9h964(i, j, css_id) {
        var table = document.getElementById("tinytable_828rqa6l5dyf1ea9h964");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_828rqa6l5dyf1ea9h964');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_828rqa6l5dyf1ea9h964(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_828rqa6l5dyf1ea9h964");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(0, 0, 'tinytable_css_id27w3rm47noraw0jao9hy') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(0, 1, 'tinytable_css_id3m89jaexchb74oe3w4c2') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(0, 2, 'tinytable_css_id3m89jaexchb74oe3w4c2') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(1, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(1, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(1, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(2, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(2, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(2, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(3, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(3, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(3, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(4, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(4, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(4, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(5, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(5, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(5, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(6, 0, 'tinytable_css_id7okl4i21n5s80gnmrv0t') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(6, 1, 'tinytable_css_idwoxmjaxd43reencls2rw') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(6, 2, 'tinytable_css_idwoxmjaxd43reencls2rw') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(7, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(7, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(7, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(8, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(8, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(8, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(9, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(9, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(9, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(10, 0, 'tinytable_css_idhjf7bqjh7ma26aru68nn') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(10, 1, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
window.addEventListener('load', function () { styleCell_828rqa6l5dyf1ea9h964(10, 2, 'tinytable_css_idsihzcn3dj0yxhspt2vqc') })
    </script>

    <style>
    .table td.tinytable_css_id27w3rm47noraw0jao9hy, .table th.tinytable_css_id27w3rm47noraw0jao9hy {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id3m89jaexchb74oe3w4c2, .table th.tinytable_css_id3m89jaexchb74oe3w4c2 {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idhjf7bqjh7ma26aru68nn, .table th.tinytable_css_idhjf7bqjh7ma26aru68nn {  text-align: left; }
    .table td.tinytable_css_idsihzcn3dj0yxhspt2vqc, .table th.tinytable_css_idsihzcn3dj0yxhspt2vqc {  text-align: center; }
    .table td.tinytable_css_id7okl4i21n5s80gnmrv0t, .table th.tinytable_css_id7okl4i21n5s80gnmrv0t {  border-bottom: solid 0.05em black;  text-align: left; }
    .table td.tinytable_css_idwoxmjaxd43reencls2rw, .table th.tinytable_css_idwoxmjaxd43reencls2rw {  border-bottom: solid 0.05em black;  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_828rqa6l5dyf1ea9h964" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        </thead><caption>Comparison of Panel Data Models for Murder Rate</caption>
              <tbody><tr>
                <th scope="col"> </th>
                <th scope="col">OLS</th>
                <th scope="col">Prais-Winsten</th>
              </tr>
        
        
        </tbody><tbody>
                <tr>
                  <td>Intercept          </td>
                  <td>23.3561 (2.5171)</td>
                  <td>23.6465 (4.3671)</td>
                </tr>
                <tr>
                  <td>South              </td>
                  <td>1.1486 (0.4020) </td>
                  <td>2.2336 (0.7050) </td>
                </tr>
                <tr>
                  <td>Unemployment       </td>
                  <td>0.3503 (0.0476) </td>
                  <td>0.0312 (0.0349) </td>
                </tr>
                <tr>
                  <td>High School Diploma</td>
                  <td>-0.2160 (0.0300)</td>
                  <td>-0.2069 (0.0546)</td>
                </tr>
                <tr>
                  <td>Citizen Ideology   </td>
                  <td>-0.0834 (0.0073)</td>
                  <td>-0.0317 (0.0064)</td>
                </tr>
                <tr>
                  <td>Per Capita Income  </td>
                  <td>0.0001 (0.0000) </td>
                  <td>0.0000 (0.0000) </td>
                </tr>
                <tr>
                  <td>N                  </td>
                  <td>950             </td>
                  <td>950             </td>
                </tr>
                <tr>
                  <td>R²                 </td>
                  <td>0.407           </td>
                  <td>0.361           </td>
                </tr>
                <tr>
                  <td>Adjusted R²        </td>
                  <td>0.404           </td>
                  <td>0.357           </td>
                </tr>
                <tr>
                  <td>AR(1) coefficient  </td>
                  <td>                </td>
                  <td>0.818           </td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
<details class="code-fold">
<summary>prediction code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get range of unemployment values in the data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>unemp_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(states<span class="sc">$</span>unemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">max</span>(states<span class="sc">$</span>unemp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>bucolors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#005A43"</span>, <span class="st">"#6CC24A"</span>, <span class="st">"#A7DA92"</span>, <span class="st">"#BDBEBD"</span>, <span class="st">"#000000"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction dataframe for each unemployment value</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># For OLS model predictions</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(u <span class="cf">in</span> unemp_range) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create prediction dataset with current unemployment value</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  pred_data <span class="ot">&lt;-</span> states</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  pred_data<span class="sc">$</span>unemp <span class="ot">&lt;-</span> u</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get predictions for OLS model</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  pred_ols <span class="ot">&lt;-</span> <span class="fu">predict</span>(ms_ols, <span class="at">newdata =</span> pred_data)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate summary statistics</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  ols_median <span class="ot">&lt;-</span> <span class="fu">median</span>(pred_ols, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  ols_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(pred_ols, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(pred_ols)))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add to results</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">unemp =</span> u,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> <span class="st">"OLS"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predicted =</span> ols_median,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">se =</span> ols_se</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                   ))</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># For Prais-Winsten model predictions</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual prediction using coefficients since predict() might not work properly</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>pw_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(ms_pw)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a separate dataframe for Prais-Winsten predictions</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>pw_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(u <span class="cf">in</span> unemp_range) {</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each unemployment value, calculate predictions for all observations</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  pred_data <span class="ot">&lt;-</span> states</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  pred_data<span class="sc">$</span>unemp <span class="ot">&lt;-</span> u</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Manual prediction</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  pw_preds <span class="ot">&lt;-</span> pw_coefs[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>              pw_coefs[<span class="st">"south"</span>] <span class="sc">*</span> pred_data<span class="sc">$</span>south <span class="sc">+</span> </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>              pw_coefs[<span class="st">"unemp"</span>] <span class="sc">*</span> pred_data<span class="sc">$</span>unemp <span class="sc">+</span> </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>              pw_coefs[<span class="st">"hsdip"</span>] <span class="sc">*</span> pred_data<span class="sc">$</span>hsdip <span class="sc">+</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>              pw_coefs[<span class="st">"citid"</span>] <span class="sc">*</span> pred_data<span class="sc">$</span>citid <span class="sc">+</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>              pw_coefs[<span class="st">"prcapinc"</span>] <span class="sc">*</span> pred_data<span class="sc">$</span>prcapinc</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate summary statistics</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  pw_median <span class="ot">&lt;-</span> <span class="fu">median</span>(pw_preds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  pw_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(pw_preds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(pw_preds)))</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add to results</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  pw_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pw_results, </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>(</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">unemp =</span> u,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"Prais-Winsten"</span>,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                       <span class="at">predicted =</span> pw_median,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                       <span class="at">se =</span> pw_se</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                     ))</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both sets of results</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, pw_results)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate confidence intervals (95%)</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>lower <span class="ot">&lt;-</span> results<span class="sc">$</span>predicted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> results<span class="sc">$</span>se</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>upper <span class="ot">&lt;-</span> results<span class="sc">$</span>predicted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> results<span class="sc">$</span>se</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the predictions from both models with custom colors</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">x =</span> unemp, <span class="at">y =</span> predicted, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> model), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted Murder Rate by Unemployment Level"</span>,</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparison between OLS and Prais-Winsten models"</span>,</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Unemployment Rate (%)"</span>,</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Murder Rate"</span>,</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Shaded areas represent 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> bucolors[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">+</span>  <span class="co"># Use first two BU colors for lines</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bucolors[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">+</span>   <span class="co"># Match fill colors to line colors</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="timevariance25_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</section>
<section id="dynamic-models" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-models">Dynamic Models</h2>
<p>Lagging <span class="math inline">\(y_t\)</span> and including it on the right hand side of the regression equation can ameliorate autocorrelation, but it changes the interpretation of the coefficients (all of them).</p>
<p>Lagging <span class="math inline">\(y_t\)</span> is powerful - it generally is a poor choice for dealing with autocorrelation, but a great choice for estimating long term effects - these are known as <em>dynamic models</em>.</p>
<p>Lagging <span class="math inline">\(x\)</span> variables is also a great choice if theory implies the effect of <span class="math inline">\(x\)</span> is spread over time, and accumulates in some fashion - these models are known as <em>distributed lag models</em>.</p>
<p>Dynamic models allow us to examine the long-term effects of changes in <span class="math inline">\(x\)</span> on <span class="math inline">\(y_t\)</span>. The equation we estimate is</p>
<p><span class="math display">\[
y_t=+ \gamma y_{t-1}+ \beta_{0}+\beta_{1}X_{1} + \beta_{2}X_{2} \ldots +  \beta_{k}X_{k}
\]</span></p>
<p>where the first term estimates the “memory” in the <span class="math inline">\(y\)</span>-series. That is, it measures how much the present value of <span class="math inline">\(y\)</span> is a function of remembering the value of <span class="math inline">\(y\)</span> at <span class="math inline">\(t-1\)</span>. Thinking of <span class="math inline">\(-1 &lt;\gamma&lt; 1\)</span>, as <span class="math inline">\(|\gamma|\)</span> increases, so does memory.</p>
<p>What does it mean for these lag-models to be dynamic? In the OLS setting, <span class="math inline">\(x\)</span> has a <span class="math inline">\(\beta\)</span> effect on <span class="math inline">\(y\)</span>. In this setting, if <span class="math inline">\(x_t\)</span> has a <span class="math inline">\(\beta\)</span> effect on <span class="math inline">\(y_t\)</span>, and if <span class="math inline">\(\gamma \neq 0\)</span>, then <span class="math inline">\(x_t\)</span> also has some effect on <span class="math inline">\(y_{t+1}\)</span>. In other words, the determinants of <span class="math inline">\(y\)</span> also exhibit a sort of memory-like, accumulating effect on future values of <span class="math inline">\(y\)</span>.</p>
<p>What these models permit is measurement of short term effects - <span class="math inline">\(\beta_k\)</span>; and long term effects <span class="math inline">\(\frac{\beta_k}{1-\gamma}\)</span>.</p>
<p>Why not use lags of <span class="math inline">\(y\)</span> to deal with autocorrelation? The AR problem is that <span class="math inline">\(u_t\)</span> is correlated with <span class="math inline">\(u_{t-1}\)</span>. In the dynamic setting, if these observations on the error are correlated, they must also be correlated with <span class="math inline">\(y_{t-1}\)</span> - this is a big problem because now, one of the regressors is correlated with <span class="math inline">\(u\)</span> - an endogeneity-like problem. Whereas AR usually causes inefficiency alone, in the dynamic model it also produces biased estimates.</p>
<p>For this reason, it’s inadvisable to use a lag strategy to deal with AR. It’s also advisable to test for AR in dynamic models, and to use AR methods (like Prais-Winsten) to deal with AR problems in dynamic models.</p>
</section>
</section>
<section id="variance" class="level1">
<h1>Variance</h1>
<p>The OLS model assumes the errors are <em>identically</em> distributed, again, part of i.i.d.:</p>
<p><strong>Homoskedastic disturbances:</strong> <span class="math inline">\(Var(u|x_1,x_2,\ldots,x_k)=\sigma^2\)</span></p>
<p>which means that the variance of the residuals, given the <span class="math inline">\(X\)</span> variables, is a constant, <span class="math inline">\(\sigma^2\)</span>. What would make this fail?</p>
<p>Suppose we’re modeling individual consumer spending on luxury items like sports cars, speed boats, golden toilets, and vacation homes. One of the main predictors of luxury item purchases is income; we’d expect as income increases, so does spending on luxury items.</p>
<p>Notice this prediction is about the mean of the <span class="math inline">\(y\)</span> variable - the expected value (predicted mean) of <span class="math inline">\(y\)</span> will increase with income. But what if the variance of spending on luxury items also increases with income? For simplicity, think about two income groups.</p>
<ul>
<li><p>low income: expected mean spending is low; as a group they will behave very uniformly, spending very little on luxury items.</p></li>
<li><p>high income: expected mean spending is high; as a group they will <strong>not</strong> behave uniformly. Some will spend lavishly on gold toilets and the like (Donald Trump), while others will shop at Walmart (Warren Buffett).</p></li>
</ul>
<p>The OLS model <span class="math inline">\(\text{luxury spending} = \beta_0 + \beta_1\text{income}\)</span> will likely produce a positive, significant estimate for <span class="math inline">\(\beta_1\)</span> indicating the mean of spending increases with income. But because the variance is different between the two groups (or actually, the variance is increasing with income), the OLS model will be inefficient, so the standard errors will be wrong.</p>
<p>Moreover, notice that we’re missing an interesting part of the story - with resources comes choice, and with choice comes variance in behavior.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Variance is not a nuisance">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Variance is not a nuisance
</div>
</div>
<div class="callout-body-container callout-body">
<p>When we only develop stories about mean behavior, we neglect interesting stories about variance. In many of the phenomena we study, we should consider stories about uniformity of behavior and the sources of that uniformity - these are stories about variance.</p>
</div>
</div>
<section id="what-is-non-constant-variance" class="level2">
<h2 class="anchored" data-anchor-id="what-is-non-constant-variance">What is non constant variance</h2>
<p>Nonconstant variance - subgroups in the data have different error variances:</p>
<ul>
<li>those with large variances contain less information.</li>
<li>those with small variances contain more information.</li>
</ul>
<p>Consider how this influences our measures of uncertainty.</p>
<p>Thinking of non constant variance in terms of explanatory variables, lower values of <span class="math inline">\(x\)</span> explain <span class="math inline">\(y\)</span> well; higher values of <span class="math inline">\(x\)</span> do not explain as well.</p>
</section>
<section id="why-does-it-happen" class="level2">
<h2 class="anchored" data-anchor-id="why-does-it-happen">Why does it happen?</h2>
<ul>
<li><p>built-in limits on behavior - the number of responses in <span class="math inline">\(y\)</span> is related to the variability in <span class="math inline">\(y\)</span>, and therefore in <span class="math inline">\(\epsilon\)</span>. E.g., as income increases, so does mean spending and variability in spending. As income declines, spending declines and variability is limited by the low level. E.g. successful coups - as the number of coups increases, the variance in coup outcomes will also increase.</p></li>
<li><p>training or learning - individuals better at a task will have smaller variance than novices. Major league hitters will have smaller variances than minor leaguers; grad students will have large variances in publishing out comes than faculty.</p></li>
<li><p>data issues - different collection rules (e.g.&nbsp;MIDs); aggregation.</p></li>
</ul>
</section>
<section id="what-to-do" class="level2">
<h2 class="anchored" data-anchor-id="what-to-do">What to do?</h2>
<p>While most discussions of heteroskedasticity focus on diagnosis and correction, my view is that the possibility (or probability) the variance is not constant is something on which to theorize ex ante.</p>
</section>
<section id="visualizing-variance" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-variance">Visualizing variance</h2>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xb <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="at">min=</span><span class="sc">-</span><span class="dv">4</span>, <span class="at">max=</span><span class="dv">4</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pdf1 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(xb, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>pdf2 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(xb, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(.<span class="dv">5</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>pdf3 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(xb, <span class="at">mean=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">1.5</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>pdf4 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(xb)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(xb, pdf1, pdf2, pdf3, pdf4)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df, <span class="fu">aes</span>(<span class="at">x=</span>xb, <span class="at">y=</span>pdf1)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>pdf2), <span class="at">linetype=</span><span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>pdf3), <span class="at">linetype=</span><span class="st">"longdash"</span> ) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> .<span class="dv">1</span>, <span class="at">label =</span> <span class="st">"Normal (0,1)"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">4</span>, <span class="at">label =</span> <span class="st">"Normal (0, .5)"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">3.3</span>, <span class="at">y =</span> .<span class="dv">2</span>, <span class="at">label =</span> <span class="st">"Normal (-1, 1.5)"</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">"Pr(Y=1)"</span>, <span class="at">x=</span><span class="st">"x"</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normal PDFs"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timevariance25_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variance-of-epsilon" class="level2">
<h2 class="anchored" data-anchor-id="variance-of-epsilon">Variance of <span class="math inline">\(\epsilon\)</span></h2>
<p>The variance of <span class="math inline">\(\epsilon\)</span> in OLS and in virtually all ML models can be thought of like this:</p>
<p><span class="math display">\[
var(\epsilon_i)=var(\epsilon_j) \forall i,j \ldots n \nonumber
\]</span></p>
<p>This is explicitly why we write the variance of the errors without a subscript - var(<span class="math inline">\(\epsilon\)</span>) - it is constant across all <span class="math inline">\(i\)</span>.</p>
<p>Put slightly differently, the distribution of <span class="math inline">\(\epsilon\)</span> is the same for all <span class="math inline">\(i\)</span>. This is true in the first panel below, but not the second. In the lower panel, you can see the variance of the residuals is correlated with <span class="math inline">\(x\)</span>, increasing as <span class="math inline">\(x\)</span> increases.</p>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variance</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8675309</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">=</span> x<span class="sc">^</span>.<span class="dv">5</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="fu">rnorm</span>(x,<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="fu">sqrt</span>(sigma2))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span> x <span class="sc">+</span> e</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x"</span>, <span class="at">y=</span><span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timevariance25_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variance</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8675309</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">=</span> x<span class="sc">^</span><span class="fl">1.5</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="fu">rnorm</span>(x,<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="fu">sqrt</span>(sigma2))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span> x <span class="sc">+</span> e</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x"</span>, <span class="at">y=</span><span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timevariance25_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Importantly, the errors are not i.i.d - in this case, they are not <em>identically</em> distributed.</p>
</section>
<section id="ols-variance-covariance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="ols-variance-covariance-matrix">OLS variance-covariance matrix</h2>
<p>In the simple regression case, the estimated variance of <span class="math inline">\(\beta\)</span> is given by \</p>
<p><span class="math display">\[
\widehat{\sigma}^{2}(\mathbf{X'X})^{-1} \nonumber
\]</span></p>
<p>or in scalar form, by</p>
<p><span class="math display">\[
\frac{\widehat{\sigma}^{2}}{SST} \nonumber
\]</span></p>
<p>If the variance is not constant, then the variance of <span class="math inline">\(\hat{\beta}\)</span> is given by:</p>
<p><span class="math display">\[
\text{Var}(\hat{\beta})=\frac{\sum \limits_{i=1}^{n}(x_i-\bar{x})^2\widehat{\sigma_i}^{2}}{SST^2_x} \nonumber
\]</span></p>
<p>It’s pretty easy to see that this last estimate of the variance of <span class="math inline">\(\hat{\beta}\)</span> is not equivalent to the one above it, so the variance of <span class="math inline">\(\hat{\beta}\)</span> and thus the standard error of <span class="math inline">\(\hat{\beta}\)</span> are no longer “best.” The standard errors are wrong, but we don’t generally know if they’re too big or too small. Regardless, our inferences are under threat.</p>
</section>
<section id="detection" class="level2">
<h2 class="anchored" data-anchor-id="detection">Detection</h2>
<ul>
<li>graph residuals against <span class="math inline">\(x\)</span>, against <span class="math inline">\(\hat{y}\)</span></li>
<li>statistical tests</li>
</ul>
</section>
<section id="graphical-methods" class="level2">
<h2 class="anchored" data-anchor-id="graphical-methods">Graphical methods</h2>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variance</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8675309</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">rnorm</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span><span class="fu">rnorm</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span><span class="fu">rnorm</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>simdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span>y, <span class="at">x=</span>x) </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>simdata <span class="ot">&lt;-</span> simdata[<span class="fu">order</span>(y),] <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t =</span> <span class="fu">row_number</span>(), <span class="at">e=</span><span class="fu">rnorm</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)), <span class="at">yv=</span><span class="dv">1</span><span class="fl">+1.5</span><span class="sc">*</span>t<span class="sc">+</span>e<span class="sc">*</span>t)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yv <span class="sc">~</span> t, <span class="at">data=</span>simdata)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(m2)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>simdata <span class="ot">&lt;-</span> simdata <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">fit=</span><span class="fu">predict</span>(m2, simdata), <span class="at">res=</span>yv<span class="sc">-</span>fit)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>varxy <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simdata, <span class="fu">aes</span>(<span class="at">x=</span>t, <span class="at">y=</span>yv)) <span class="sc">+</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x"</span>, <span class="at">y=</span><span class="st">"y"</span>) </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>varxr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simdata, <span class="fu">aes</span>(<span class="at">x=</span>t, <span class="at">y=</span>res)) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"x"</span>, <span class="at">y=</span><span class="st">"residuals"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>varxy <span class="sc">/</span> varxr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timevariance25_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="breusch-pagan-test" class="level2">
<h2 class="anchored" data-anchor-id="breusch-pagan-test">Breusch-Pagan test</h2>
<p>We can also detect non constant variance more mechanically by using the Breusch-Pagan test which works this way:</p>
<ul>
<li><p>Estimate the model of interest.</p></li>
<li><p>Generate the residuals, and square each individual residual, so <span class="math inline">\(u_i^2\)</span>.</p></li>
<li><p>Perform the auxiliary regression of <span class="math inline">\(u_i^2\)</span> on all the <span class="math inline">\(X\)</span>s.</p></li>
<li><p>Generate either an F-statistic or Lagrange Multiplier (LM) <span class="math inline">\(\chi^2\)</span> statistic to test the null hypothesis of homoskedasticity.</p></li>
</ul>
<p>How do we compute the F or LM statistics? The <span class="math inline">\(F_{k,n-k-1}\)</span> is computed as</p>
<p><span class="math display">\[
F_{k,n-k-1}=\frac{R^2_{\hat{u_i^2}}/k}{(1-R^2_{\hat{u_i^2}})/(n-k-1)} \nonumber
\]</span></p>
<p>where we’re really testing the null hypothesis that the <span class="math inline">\(X\)</span> variables are jointly insignificant. If the auxiliary regression <span class="math inline">\(u_i^2\)</span> on all the <span class="math inline">\(X\)</span>s produces coefficients all equal to zero, then the squared residuals are not a function of the <span class="math inline">\(X\)</span>s. If this is the case, we cannot reject the null that all the coefficients are equal to zero, the null of homoskedasticity.</p>
<p>The LM statistic is computed using the same information, but is not F-distributed - it’s distributed <span class="math inline">\(\chi^2_{k}\)</span> where <span class="math inline">\(k\)</span> is the degrees of freedom.</p>
<p><span class="math display">\[
LM \chi^2_{k} = n \cdot R^2_{\hat{u_i^2}} \nonumber
\]</span></p>
<p>If we reject the null hypothesis of homoskedasticity, we might want to take some corrective measures to account for the likelihood the variance in the error term is not constant.</p>
</section>
</section>
<section id="solutions" class="level1">
<h1>Solutions</h1>
<ul>
<li><p>Compute robust standard errors.</p></li>
<li><p>Change functional forms - often, logging the variables reduces the nonconstancy in the variance for about the same reasons it ropes-in outliers.</p></li>
<li><p>Respecify the model - if relevant variables are excluded from the model, it may exacerbate the extent to which the error variance is nonconstant. Expect it! (it’s not the Spanish Inquisition).</p></li>
<li><p>Transform the data by weighting to account for the nonconstant variance.</p></li>
<li><p>Estimate a model where we can examine the effects of variables on the variance.</p></li>
</ul>
<section id="robust-standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="robust-standard-errors">Robust Standard Errors</h2>
<p>Building on earlier work by Friedhelm Eicker and Peter Huber, <span class="citation" data-cites="white1980heteroskedasticity">White (<a href="#ref-white1980heteroskedasticity" role="doc-biblioref">1980</a>)</span> showed that it’s actually pretty simple to correct this problem, effectively to correct the variance (and standard error) of <span class="math inline">\(\beta\)</span> by using the residuals from the regression of <span class="math inline">\(y\)</span> on <span class="math inline">\(X\)</span> - in the bivariate case,</p>
<p><span class="math display">\[\begin{align*}
\text{White's Robust Variance}(\hat{\beta})=\frac{\sum \limits_{i=1}^{n}(x_i-\bar{x})^2\widehat{\hat{u}_i}^{2}}{SST_x} \nonumber
\end{align*}\]</span></p>
<p>This computation weights the estimated variance of <span class="math inline">\(\hat{\beta}\)</span> by the residual thus accounting for the empirical source of the nonconstancy.</p>
<p>This is marginally more complicated in the multiple regression case where the variance of <span class="math inline">\(\beta_j\)</span> is given by:</p>
<p><span class="math display">\[\begin{align*}
\text{White's Robust Variance}(\hat{\beta_j})=\frac{\sum \limits_{i=1}^{n} \hat{r}^2_{ij} \hat{u_i}^{2}}{SSR_j} \nonumber
\end{align*}\]</span></p>
<p>where we sum the residuals from the regression of <span class="math inline">\(x_j\)</span> on the other independent variables multiplied by <span class="math inline">\(u_i^2\)</span>, the residuals from the original regression, and divide by the sum squared residual from this auxiliary regression.</p>
<p>This technique (which has been derived by several different econometricians including those named above) can be written mathematically in several different ways and computed in least squares or in maximum likelihood. It is probably most commonly known either as the White or White-Huber or Robust variance estimator.</p>
<section id="panel-data" class="level3">
<h3 class="anchored" data-anchor-id="panel-data">Panel data</h3>
<p>The units in panel data can be significant sources of non constant variance. After all, the units surely will vary on any number of dimensions we model in the <span class="math inline">\(X\)</span> variables; it’s not hard to imagine that the conditional variances will also be different across those cross-sections. Robust standard errors are a good choice for dealing with this problem in panel data - it’s very common to see robust standard errors in panel data models.</p>
<p>You’ll often see the term “clustered” used in the context of robust standard errors. The difference here lies in where you assume the heterskedasticity lies. Robust standard errors account for variance across all observations; clustered robust standard errors account for variance within panels (or whatever you cluster on). The computation is the same, and both are “robust” to nonconstant variance.</p>
<p>You should also note <span class="citation" data-cites="stock2008heteroskedasticity">Stock and Watson (<a href="#ref-stock2008heteroskedasticity" role="doc-biblioref">2008</a>)</span> show that robust (non-clustered) standard errors are not valid with fixed effects - if you have a fixed effects model, cluster on panels.</p>
<p>In R, compute robust/clustered standard errors using the “sandwich” library (the forumula for the Huber-White standard errors resembles a sandwich if you look at it long enough). You can add these new standard errors to your model output and generate appropriate tests (e.g.&nbsp;t-tests for the linear model) using “coeftest” in the “lmtest” library.</p>
</section>
</section>
<section id="weighting-wls" class="level2">
<h2 class="anchored" data-anchor-id="weighting-wls">Weighting (WLS)</h2>
<p>Another alternative is GLS, specifically “Weighted Least Squares”:</p>
<p>The intuition is simple - weight estimation by the values of the variable(s) that we think is (are) associated with nonconstant error variance. In effect, dividing the entire estimating equation by <span class="math inline">\(x\)</span> will also weight the estimated variance of the error term, and thus return the model to homoskedasticity (assuming that variable is the sole source of nonconstant variance). We would benefit from doing this because we believe there are two types of cases in the data:</p>
<ul>
<li><p>cases with larger variances in <span class="math inline">\(y\)</span> due to <span class="math inline">\(x\)</span> contain less precise information.</p></li>
<li><p>cases with smaller variances in <span class="math inline">\(y\)</span> due to <span class="math inline">\(x\)</span> contain more precise information.</p></li>
</ul>
<p>Ideally, what we would like to do is produce constant-variance residuals based on these differences so that their variances are equal.</p>
<p>Suppose we could divide both sides of our model by <span class="math inline">\(\sigma_i\)</span> (if we knew it), the standard deviation of the residual, so</p>
<p><span class="math display">\[\begin{align*}
\frac{Y}{\sigma_i}=\beta_0\frac{1}{\sigma_i} + \beta_1 \frac{X_1}{\sigma_i} + \beta_2 \frac{X_2}{\sigma_{i,t}} +
\frac{u_{i,t}}{\sigma_{i,t}} \nonumber
\end{align*}\]</span></p>
<p>This weights each individual case by the standard deviation of its residual, so those cases with larger variances (and standard deviations) are weighted to count less, those with smaller variances are weighted to count more. And the variance of the error term itself is now:</p>
<p><span class="math display">\[
E\left[\frac{u_{i,t}}{\sigma_{i,t}}\right]^2 =  \frac{1}{\sigma_i^2}E[u_{i,t}^2]  \nonumber \\ \nonumber \\
=\frac{1}{\sigma_i^2}(\sigma^2) ~~~~~\text{because} ~~~~~E(u_i^2)=\sigma^2  \nonumber \\ \nonumber \\
=1 \nonumber
\]</span></p>
<p>Because</p>
<p><span class="math display">\[
Var(u_{i,t})={\sigma_{i,t}}^2 X{_{i,t}} \nonumber
\]</span></p>
<p>the variance of the error term is proportional to <span class="math inline">\(X_i\)</span>, so we can divide each side of the equation by <span class="math inline">\(X_i\)</span> to transform the data, estimate our OLS model, and no longer violate the assumption the error variance is constant. Neat, eh?</p>
</section>
<section id="modeling-variance" class="level2">
<h2 class="anchored" data-anchor-id="modeling-variance">Modeling Variance</h2>
<p>Variance is not a nuiscance - it’s a feature of the data that we should theorize about. This is a potentially rich part of our literature largely neglected. Variance models in general do the following:</p>
<ul>
<li><p>test hypotheses about mean differences in <span class="math inline">\(y\)</span> given <span class="math inline">\(X\)</span>. This is the usual enterprise, and such hypotheses are about how the mean of <span class="math inline">\(y\)</span> increases/decreases given a change in <span class="math inline">\(x\)</span>.</p></li>
<li><p>test hypotheses about variance differences in <span class="math inline">\(y\)</span> given <span class="math inline">\(X\)</span>. This is a less common enterprise, and such hypotheses are about how the variance of <span class="math inline">\(y\)</span> increases/decreases given a change in <span class="math inline">\(x\)</span>.</p></li>
</ul>
<p>Thinking of the income and luxary spending example, we have hypotheses on both the mean and the variance of spending given changes in income.</p>
</section>
<section id="variance-model-example" class="level2">
<h2 class="anchored" data-anchor-id="variance-model-example">Variance model example</h2>
<p>Here’s an example in the international relations literature motivated by economic models of resources and spending. The international conflict literature has a couple of competing views on how capabilities shape the chances of conflict - note, these are claims about how capabilities shape the <em>mean</em> levels of conflict. <span class="citation" data-cites="clarketalajps08">Clark, Nordstrom, and Reed (<a href="#ref-clarketalajps08" role="doc-biblioref">2008</a>)</span> argues conflict choices arise as a function of capabilities because such resources make conflict possible, and permit discretion over if/when to engage in conflict.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>In other words, capabilities might increase the mean level of conflict, but they also influence the variance in when and whether states choose conflict. States without resources have few choices, and will choose military conflict less often then resource rich states - they’ll do so uniformly because of their resource constraint. States with plenty of resources will choose conflict more often because they can, but will do so more variantly or more diffusely.</p>
<p>So we have two hypotheses regarding how capabilities shape conflict:</p>
<ul>
<li><p>capabilities increase the mean level of conflict.</p></li>
<li><p>capabilities increase the variance in conflict.</p></li>
</ul>
</section>
<section id="the-model" class="level2">
<h2 class="anchored" data-anchor-id="the-model">The model</h2>
<p>The variance model is two equations, one anticipating <span class="math inline">\(X\)</span> variables’ effects on the mean, the other anticipating <span class="math inline">\(X\)</span> variables’ effects on the variance. It’s usually estimated using ML. The model below uses aggregated dyadic event data over the period 1948-1978. The <span class="math inline">\(y\)</span> variable is the number of conflictual events the pair engages in during a year. The <span class="math inline">\(X\)</span> variables are the capabilities of the each state in the dyad, the lower polity score in the pair, distance between the states in the dyad, whether they’re allies, and the aggregate level of cooperationt in the dyad year.</p>
<p>First, let’s look at the constant variance model - i.e., the OLS model only testing hypotheses about the mean level of conflict.</p>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#substitution data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"/Users/dave/Documents/2005/mpsa05/sub/data/crn_ajps08.dta"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># constant var model</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>mv2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(SUMconf<span class="sc">~</span> cap_1 <span class="sc">+</span> cap_2<span class="sc">+</span> demlow<span class="sc">+</span> ally <span class="sc">+</span> lndist<span class="sc">+</span> SUMcoop, <span class="at">data=</span>sub)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mv2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = SUMconf ~ cap_1 + cap_2 + demlow + ally + lndist + 
    SUMcoop, data = sub)

Residuals:
    Min      1Q  Median      3Q     Max 
 -49.29   -4.42   -1.85    0.76 1681.19 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.28980    0.64887  -0.447 0.655149    
cap_1       18.75053    2.43718   7.694  1.5e-14 ***
cap_2       26.40155    2.43369  10.848  &lt; 2e-16 ***
demlow      -0.17418    0.04758  -3.661 0.000252 ***
ally        -3.69596    0.44125  -8.376  &lt; 2e-16 ***
lndist       0.03244    0.07557   0.429 0.667778    
SUMcoop      0.27555    0.01242  22.190  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.75 on 18026 degrees of freedom
Multiple R-squared:  0.04101,   Adjusted R-squared:  0.04069 
F-statistic: 128.5 on 6 and 18026 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>And now let’s look at the variance model testing hypotheses about both the mean and the variance of conflict.</p>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variance model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mv3 <span class="ot">&lt;-</span> <span class="fu">dglm</span>(SUMconf<span class="sc">~</span> cap_1 <span class="sc">+</span> cap_2<span class="sc">+</span> demlow<span class="sc">+</span> ally <span class="sc">+</span> lndist<span class="sc">+</span> SUMcoop, <span class="at">dformula=</span> <span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>cap_1 <span class="sc">+</span> cap_2, <span class="at">data=</span>sub)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mv3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: dglm(formula = SUMconf ~ cap_1 + cap_2 + demlow + ally + lndist + 
    SUMcoop, dformula = ~1 + cap_1 + cap_2, data = sub)

Mean Coefficients:
               Estimate Std. Error    t value     Pr(&gt;|t|)
(Intercept)  0.13765851 0.45000904  0.3059017 7.596831e-01
cap_1       15.21375136 3.33231521  4.5655199 5.015517e-06
cap_2       13.13900439 1.53838801  8.5407611 1.438125e-17
demlow      -0.07717211 0.03026943 -2.5495070 1.079574e-02
ally        -1.87046157 0.29380348 -6.3663697 1.982284e-10
lndist       0.13122354 0.05179661  2.5334388 1.130335e-02
SUMcoop      0.19237400 0.01013310 18.9847192 1.363534e-79
(Dispersion Parameters for gaussian family estimated as below )

    Scaled Null Deviance: 18541.27 on 18032 degrees of freedom
Scaled Residual Deviance: 18032.99 on 18026 degrees of freedom

Dispersion Coefficients:
             Estimate Std. Error   z value     Pr(&gt;|z|)
(Intercept)  4.598776 0.01940801 236.95244 0.000000e+00
cap_1       15.227604 0.14596388 104.32446 0.000000e+00
cap_2        3.060046 0.14721074  20.78684 5.693915e-96
(Dispersion parameter for Gamma family taken to be 2 )

    Scaled Null Deviance: 76876.86 on 18032 degrees of freedom
Scaled Residual Deviance: 68133.7 on 18030 degrees of freedom

Minus Twice the Log-Likelihood: 155219.4 
Number of Alternating Iterations: 33 </code></pre>
</div>
</div>
<p>Let’s look at predictions just from the variance vector. Since the model is linear, the likelihood function is normal with variance <span class="math inline">\(\sigma^2\)</span> parameterized as a set of <span class="math inline">\(X\)</span> variables (in this case, capabilities and a constant). The predictions are just the variance of the normal, so <span class="math inline">\(exp(X\beta)\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">coef</span>(mv3))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">coef</span>(mv3<span class="sc">$</span>dispersion.fit))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># at mean predictions</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>vpreds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span> , <span class="at">cap_1=</span><span class="fu">seq</span>(.<span class="dv">01</span>, .<span class="dv">33</span>, .<span class="dv">01</span>), <span class="at">cap_2=</span>.<span class="dv">025</span> )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">as.matrix</span>(vpreds)<span class="sc">%*%</span><span class="fu">as.matrix</span>(v))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">cbind</span>(vpreds, preds), <span class="fu">aes</span>(<span class="at">x=</span>cap_1, <span class="at">y=</span>preds)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Capabilities State 1"</span>, <span class="at">y=</span><span class="st">"Variance"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Expected Variance in Conflict"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timevariance25_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Consistent with the coefficients in the variance vector, increases in capabilities increase the predicted variance in conflict behavior. States with greater capacity engage in more conflict (higher mean levels, per hypothesis one), and do so more variably (higher variance, per hypothesis two).</p>
</section>
<section id="aside-on-measurement" class="level2">
<h2 class="anchored" data-anchor-id="aside-on-measurement">Aside on Measurement</h2>
<p>Be clear what you’re measuring.</p>
<p><img src="surfturf.jpeg" class="img-fluid"></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-clarketalajps08" class="csl-entry" role="listitem">
Clark, David H., Timothy Nordstrom, and William Reed. 2008. <span>“Substitution Is in the Variance: Resources and Foreign Policy Choice.”</span> <em>American Journal of Political Science</em> 52 (4): 763–73.
</div>
<div id="ref-stock2008heteroskedasticity" class="csl-entry" role="listitem">
Stock, James H, and Mark W Watson. 2008. <span>“Heteroskedasticity-Robust Standard Errors for Fixed Effects Panel Data Regression.”</span> <em>Econometrica</em> 76 (1): 155–74.
</div>
<div id="ref-white1980heteroskedasticity" class="csl-entry" role="listitem">
White, Halbert. 1980. <span>“A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 817–38.
</div>
</div>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>They argue the same is true of cooperative behavior, and model a system of equations with variance functions. This is a single-equation version of the model they present.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>